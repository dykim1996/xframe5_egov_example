/* 2020-10-30 18:04 */ function XF_UPLOADER(a,b){this._init(a,b),this._prop(b),this._box()}XF_UPLOADER.UPLOAD_STATUS_NONE=1,XF_UPLOADER.UPLOAD_STATUS_WAIT=2,XF_UPLOADER.UPLOAD_STATUS_ING=3,XF_UPLOADER.UPLOAD_STATUS_CANCEL=4,XF_UPLOADER.UPLOAD_STATUS_DONE=9,XF_UPLOADER.UPLOAD_RESULT_SUCCESS=1,XF_UPLOADER.UPLOAD_RESULT_FAIL=0,XF_UPLOADER.prototype._init=function(a,b){_xfx.init(this,a,XFD_OBJKIND_CONTROL,XFD_CTRLKIND_UPLOADER,b),this.is_stop_upload=!1,this.is_uploading=!1,this.file_info_arr=[]},XF_UPLOADER.prototype._prop=function(a){this.xf_prop={url:"",serial_upload:!1,async_upload:!0,allow_multifile:!0,multi_upload:!1,accept:"",enable:!0,hidden:!0,enterstop:!0,tabstop:!0,with_credentials:!0},this.event_name_arr=["on_uploadcomplete","on_fileprogress","on_filecomplete","on_listupdate","on_fileadd","on_filedelete"],_xfx.propcommon(this,this.xf_prop),_xfx.propparam(this,this.xf_prop,a),this._css(a)},XF_UPLOADER.prototype._css=function(a){1!=_xf_htmlready_mode&&_xfx.propcss(this,a,this.css_arr,["position","hidden"])},XF_UPLOADER.prototype._box=function(){var a;0==_xf_htmlready_mode&&(a=[],a.push("<div"),a.push(' id="'+this.xf_prop.internal_name+'"'),a.push(' class="'+_xfx.propclass(this,this.xf_prop,"_xf_uploader")+'"'),a.push(' style="'),a.push(this.css_arr.join("")),_xfx.sizeposcss(this,this.xf_prop,a),a.push('">'),a.push('<input type="file" class="_xf_uploader_input"'),a.push(' accept="'+this.xf_prop.accept+'"'),1==this.xf_prop.allow_multifile&&a.push(" multiple"),a.push("/>"),a.push("</div>")),_xfx.register(this,!1,a)},XF_UPLOADER.prototype._dom=function(){this.xf_file=this.xf_object.find("._xf_uploader_input")},XF_UPLOADER.prototype._offevent=function(){this.xf_file.off("change")},XF_UPLOADER.prototype._event=function(){this.xf_file.on("change",$.proxy(this.on_file_change,this))},XF_UPLOADER.prototype._create=function(){this._dom(),this._event(),factory._fireevent({xf_component:this,event_name:"on_create"},this)},XF_UPLOADER.prototype._mergefileinfoarr=function(a,b){var c,d,e,f;for(e=a.length,void 0===b&&(b=!0),c=0;e>c;c++){if(f=this.file_info_arr.length,b)for(d=0;f>d&&a[c].file_name!=this.file_info_arr[d].file_name;d++);else d=this.file_info_arr.length;d==f&&(this.file_info_arr.push(a[c]),this._resetfileindex(),factory._fireevent({xf_component:this,event_name:"on_fileadd"},this,a[c].file_index,a[c].file_name))}this._resetfileindex(),_xfu.async({context:this,func:this._on_list_update})},XF_UPLOADER.prototype._createfileinfo=function(a,b){var c,d,e,f;if(f={url:"",file_index:-1,file_object:a,file_name:b,file_size:0,file_mime_type:"",file_last_modified:new Date,file_modified_date:"",file_modified_time:"",file_brief_size:"0KB",upload_status:XF_UPLOADER.UPLOAD_STATUS_NONE,upload_result:XF_UPLOADER.UPLOAD_RESULT_FAIL,upload_message:"",upload_file_name:"",upload_progress:0,xhr:null,post_data:{},xf_upload_progress:null,xf_upload_message:null,xf_upload_status:null},a){for(f.file_name=a.name,f.file_size=a.size,f.file_mime_type=a.type,a.lastModifiedDate?f.file_last_modified=a.lastModifiedDate:f.lastModified?f.file_last_modified=new Date(a.lastModified):f.file_last_modified=new Date,d=[],d.push(f.file_last_modified.getFullYear()),d.push((f.file_last_modified.getMonth()+1).toString()),d.push(f.file_last_modified.getDate().toString()),c=1;2>=c;c++)1==d[c].length&&(d[c]="0"+d[c]);for(f.file_modified_date=d.join(""),e=[],e.push(f.file_last_modified.getHours().toString()),e.push(f.file_last_modified.getMinutes().toString()),e.push(f.file_last_modified.getSeconds().toString()),c=0;2>=c;c++)1==e[c].length&&(e[c]="0"+e[c]);f.file_modified_time=e.join(""),f.file_brief_size=this._getfilebriefsize(f.file_size)}return f},XF_UPLOADER.prototype._getfilebriefsize=function(a){var b,c,d,e;for(b=["KB","MB","GB","TB","PB","EB","ZB","YB"],c=0,e=a+"B",d=a/1024;d>=1;d/=1024,c++)e=d.toFixed(0)+b[c];return e},XF_UPLOADER.prototype._resetfileindex=function(){var a,b;for(b=this.file_info_arr.length,a=0;b>a;a++)this.file_info_arr[a].file_index=a},XF_UPLOADER.prototype._setfilestatus=function(a,b,c,d,e){a.upload_status=b,a.upload_result=c,a.upload_message=d,e&&this._on_file_complete(a)},XF_UPLOADER.prototype._uploadonefile=function(a){var b,c,d;if(null===a)return!0;if(a.upload_status=XF_UPLOADER.UPLOAD_STATUS_ING,b=new FormData,a.file_object&&b.append("_XF_UPLOADER_FILE",a.file_object),a.xhr=new XMLHttpRequest,c=0==a.url.length?this.xf_prop.url:a.url,a.post_data)for(d in a.post_data)b.append(d,a.post_data[d]);a.xhr.open("POST",c,this.xf_prop.async_upload),a.xhr.withCredentials=this.xf_prop.with_credentials,$(a.xhr).on("load",a,$.proxy(this.on_upload_load,this)),$(a.xhr).on("error",a,$.proxy(this.on_upload_error,this)),$(a.xhr).on("abort",a,$.proxy(this.on_upload_abort,this)),$(a.xhr).on("timeout",a,$.proxy(this.on_upload_timeout,this)),$(a.xhr.upload).on("progress",a,$.proxy(this.on_upload_progress,this)),a.xhr.send(b)},XF_UPLOADER.prototype._uploadmultifile=function(a){var b,c,d,e,f,g;if(null===a||0==a.length)return!0;for(b=new FormData,g=a.length,e=0;g>e;e++)if(f=a[e],f.upload_status=XF_UPLOADER.UPLOAD_STATUS_ING,f.file_object&&b.append("_XF_UPLOADER_FILE_"+e,f.file_object),f.post_data)for(d in f.post_data)b.append(d,f.post_data[d]);f=a[0],f.xhr=new XMLHttpRequest,c=this.xf_prop.url,f.xhr.open("POST",c,this.xf_prop.async_upload),f.xhr.withCredentials=this.xf_prop.with_credentials,$(f.xhr).on("load",f,$.proxy(this.on_upload_load,this)),$(f.xhr).on("error",f,$.proxy(this.on_upload_error,this)),$(f.xhr).on("abort",f,$.proxy(this.on_upload_abort,this)),$(f.xhr).on("timeout",f,$.proxy(this.on_upload_timeout,this)),$(f.xhr.upload).on("progress",f,$.proxy(this.on_upload_progress,this)),f.xhr.send(b)},XF_UPLOADER.prototype.addfile=function(){return this.is_uploading?1:!this.xf_prop.allow_multifile&&this.getfilecount()>0?2:(this.xf_file.trigger("click"),0)},XF_UPLOADER.prototype.addvirtualfile=function(a){var b;return this.is_uploading?1:!this.xf_prop.allow_multifile&&this.getfilecount()>0?2:(b=[],b.push(this._createfileinfo(null,a)),this._mergefileinfoarr(b),0)},XF_UPLOADER.prototype.addfileobject=function(a,b){return this.addfileobjectarray([a],b)},XF_UPLOADER.prototype.addfileobjectarray=function(a,b){var c,d,e;if(this.is_uploading)return 1;if(!this.xf_prop.allow_multifile&&this.getfilecount()>0)return 2;for(c=[],d=a.length,e=0;d>e;e++)c.push(this._createfileinfo(a[e],""));return this._mergefileinfoarr(c,b),0},XF_UPLOADER.prototype.clearallfilestatus=function(){var a,b;if(this.is_uploading)return 1;for(a=this.file_info_arr.length,b=0;a>b;b++)this.file_info_arr[b].upload_result=XF_UPLOADER.UPLOAD_RESULT_FAIL,this.file_info_arr[b].upload_progress=0,this.file_info_arr[b].upload_message="",this.file_info_arr[b].upload_status=XF_UPLOADER.UPLOAD_STATUS_NONE,this.file_info_arr[b].upload_file_name="";return 0},XF_UPLOADER.prototype.clearfilestatusbyname=function(a){return this.clearfilestatus(this.getfileindex(a))},XF_UPLOADER.prototype.clearfilestatus=function(a){var b;return this.is_uploading?1:(a=_xfu["int"](a),b=this.file_info_arr[a],void 0===b?2:(b.upload_result=XF_UPLOADER.UPLOAD_RESULT_FAIL,b.upload_progress=0,b.upload_message="",b.upload_status=XF_UPLOADER.UPLOAD_STATUS_NONE,b.upload_file_name="",0))},XF_UPLOADER.prototype.deleteallfile=function(){return this.is_uploading?!1:(this.file_info_arr=[],void _xfu.async({context:this,func:this._on_list_update}))},XF_UPLOADER.prototype.deletefilebyname=function(a){return this.deletefile(this.getfileindex(a))},XF_UPLOADER.prototype.deletefile=function(a){var b;return this.is_uploading?1:(a=_xfu["int"](a),b=this.file_info_arr[a],void 0===b?2:(this.file_info_arr.splice(a,1),this._resetfileindex(),factory._fireevent({xf_component:this,event_name:"on_filedelete"},this,b.file_index,b.file_name),_xfu.async({context:this,func:this._on_list_update}),0))},XF_UPLOADER.prototype.getallowmultifile=function(){return this.xf_prop.allow_multifile},XF_UPLOADER.prototype.setallowmultifile=function(a){this.xf_prop.allow_multifile!=a&&(this.xf_prop.allow_multifile=a,this.xf_file.prop("multiple",a))},XF_UPLOADER.prototype.getfilecount=function(){return this.file_info_arr.length},XF_UPLOADER.prototype.getfileindex=function(a){var b,c;for(c=this.file_info_arr.length,b=0;c>b;b++)if(this.file_info_arr[b].file_name==a)return b;return-1},XF_UPLOADER.prototype.getaccept=function(){return this.xf_prop.accept},XF_UPLOADER.prototype.setaccept=function(a){return this.xf_prop.accept=a,this.xf_file.attr("accept",a),!0},XF_UPLOADER.prototype.getfilename=function(a){var b;return b=this._getfileinfo(a),b?b.file_name:""},XF_UPLOADER.prototype.getfiledatebyname=function(a){return this.getfiledate(this.getfileindex(a))},XF_UPLOADER.prototype.getfiledate=function(a){var b;return b=this._getfileinfo(a),b?b.file_modified_date:""},XF_UPLOADER.prototype.getfiletimebyname=function(a){return this.getfiletime(this.getfileindex(a))},XF_UPLOADER.prototype.getfiletime=function(a){var b;return b=this._getfileinfo(a),b?b.file_modified_time:""},XF_UPLOADER.prototype.getfiledatetimebyname=function(a,b){return this.getfiledatetime(this.getfileindex(a,b))},XF_UPLOADER.prototype.getfiledatetime=function(a,b){var c;return(c=this._getfileinfo(a))?(void 0===b&&(b=" "),c.file_modified_date+b+c.file_modified_time):""},XF_UPLOADER.prototype.getfilesizebyname=function(a){return this.getfilesize(this.getfileindex(a))},XF_UPLOADER.prototype.getfilesize=function(a){var b;return b=this._getfileinfo(a),b?b.file_size:-1},XF_UPLOADER.prototype.getfilebriefsizebyname=function(a){return this.getfilebriefsize(this.getfileindex(a))},XF_UPLOADER.prototype.getfilebriefsize=function(a){var b;return b=this._getfileinfo(a),b?b.file_brief_size:""},XF_UPLOADER.prototype.getfileprogressbyname=function(a){return this.getfileprogress(this.getfileindex(a))},XF_UPLOADER.prototype.getfileprogress=function(a){var b;return b=this._getfileinfo(a),b?b.upload_progress:-1},XF_UPLOADER.prototype.getfilestatusbyname=function(a){return this.getfilestatus(this.getfileindex(a))},XF_UPLOADER.prototype.getfilestatus=function(a){var b;return b=this._getfileinfo(a),b?b.upload_status:-1},XF_UPLOADER.prototype.getfileresultbyname=function(a){return this.getfileresult(this.getfileindex(a))},XF_UPLOADER.prototype.getfileresult=function(a){var b;return b=this._getfileinfo(a),b?b.upload_result:-1},XF_UPLOADER.prototype.getfileresultmsgbyname=function(a){return this.getfileresultmsg(this.getfileindex(a))},XF_UPLOADER.prototype.getfileresultmsg=function(a){var b;return b=this._getfileinfo(a),b?b.upload_message:""},XF_UPLOADER.prototype.getfileresultfilenamebyname=function(a){return this.getfileresultfilename(this.getfileindex(a))},XF_UPLOADER.prototype.getfileresultfilename=function(a){var b;return b=this._getfileinfo(a),b?b.upload_file_name:""},XF_UPLOADER.prototype.getfileurlbyname=function(a){return this.getfileurl(this.getfileindex(a))},XF_UPLOADER.prototype.getfileurl=function(a){var b;return b=this._getfileinfo(a),b?b.url:""},XF_UPLOADER.prototype.setfileurlbyname=function(a,b){return this.setfileurl(this.getfileindex(a),b)},XF_UPLOADER.prototype.setfileurl=function(a,b){var c;return(c=this._getfileinfo(a))?(c.url=b,!0):!1},XF_UPLOADER.prototype.setfilepostdataobjectbyname=function(a,b){return this.setfilepostdataobject(this.getfileindex(a),b)},XF_UPLOADER.prototype.setfilepostdataobject=function(a,b){var c;return(c=this._getfileinfo(a))?($.extend(c.post_data,b),!0):!1},XF_UPLOADER.prototype.setfilepostdatavaluebyname=function(a,b,c){return this.setfilepostdatavalue(this.getfileindex(a),b,c)},XF_UPLOADER.prototype.setfilepostdatavalue=function(a,b,c){var d;return(d=this._getfileinfo(a))?(d.post_data[b]=c,!0):!1},XF_UPLOADER.prototype.getfilepostdatavaluebyname=function(a,b){return this.getfilepostdatavalue(this.getfileindex(a),url)},XF_UPLOADER.prototype.getfilepostdatavalue=function(a,b){var c;return c=this._getfileinfo(a),c?c.post_data&&c[b]?c[b]:"":null},XF_UPLOADER.prototype.getfilepostdataobjectbyname=function(a){return this.getfilepostdataobject(this.getfileindex(a))},XF_UPLOADER.prototype.getfilepostdataobject=function(a){var b;return b=this._getfileinfo(a),b?b.post_data:null},XF_UPLOADER.prototype._getfileinfo=function(a){return a=_xfu["int"](a),this.file_info_arr[a]?this.file_info_arr[a]:null},XF_UPLOADER.prototype.getserialupload=function(){return this.xf_prop.serial_upload},XF_UPLOADER.prototype.setserialupload=function(a){this.xf_prop.serial_upload=a},XF_UPLOADER.prototype.getasyncupload=function(){return this.xf_prop.async_upload},XF_UPLOADER.prototype.setasyncupload=function(a){this.xf_prop.async_upload=a},XF_UPLOADER.prototype.getmultiupload=function(){return this.xf_prop.multi_upload},XF_UPLOADER.prototype.setmultiupload=function(a){this.xf_prop.multi_upload=a},XF_UPLOADER.prototype.getwithcredentials=function(){return this.xf_prop.with_credentials},XF_UPLOADER.prototype.setwithcredentials=function(a){this.xf_prop.with_credentials=a},XF_UPLOADER.prototype.geturl=function(){return this.xf_prop.url},XF_UPLOADER.prototype.seturl=function(a){this.xf_prop.url=a},XF_UPLOADER.prototype.startupload=function(){var a,b;if(b=this.file_info_arr.length,0==b)return alert(factory._userlang("업로드 대상 파일이 없습니다.","No upload file found")),!0;if(0==this.xf_prop.allow_multifile&&this.getfilecount()>1)return void alert(factory._userlang("하나의 파일만 업로드가 가능합니다.","Only one file can be uploaded."));if(0==this.xf_prop.url.length)return alert(factory._userlang("URL이 지정되지 않았습니다.","URL not specified.")),!1;if(1==this.is_uploading)return alert(factory._userlang("이미 업로드가 진행중입니다.","Upload is already in progress.")),!1;if(this.clearallfilestatus(),this.is_uploading=!0,this.is_stop_upload=!1,this.file_info_index=0,1==this.xf_prop.multi_upload)this._uploadmultifile(this.file_info_arr);else if(1==this.xf_prop.serial_upload)this._uploadonefile(this.file_info_arr[0]);else for(a=0;b>a;a++)this._uploadonefile(this.file_info_arr[a]);return!0},XF_UPLOADER.prototype.stopupload=function(){var a,b,c;if(this.is_stop_upload=!0,1==this.xf_prop.serial_upload)c=this.file_info_arr[this.file_info_index],c.xhr.abort();else for(b=this.file_info_arr.length,a=0;b>a;a++)c=this.file_info_arr[a],c.xhr.abort()},XF_UPLOADER.prototype._on_list_update=function(){factory._fireevent({xf_component:this,event_name:"on_listupdate",is_fire_async:!0},this)},XF_UPLOADER.prototype._on_upload_complete=function(){this.is_uploading=!1,factory._fireevent({xf_component:this,event_name:"on_uploadcomplete",is_fire_async:!0},this)},XF_UPLOADER.prototype._on_file_complete=function(a){var b,c;if(factory._fireevent({xf_component:this,event_name:"on_filecomplete",is_fire_async:!0},this,a.file_index,a.file_name),this.file_info_index++,this.is_stop_upload&&this.xf_prop.serial_upload&&!this.xf_prop.multi_upload){for(c=this.file_info_arr.length,b=this.file_info_index;c>b;b++)this.file_info_arr[b].upload_status=XF_UPLOADER.UPLOAD_STATUS_CANCEL,this.file_info_arr[b].upload_result=XF_UPLOADER.UPLOAD_RESULT_FAIL;this.file_info_index=c}return this.file_info_index<this.file_info_arr.length&&!this.xf_prop.multi_upload&&this.xf_prop.serial_upload?void this._uploadonefile(this.file_info_arr[this.file_info_index]):void(this.file_info_index>=this.file_info_arr.length&&_xfu.async({context:this,func:this._on_upload_complete}))},XF_UPLOADER.prototype.on_file_change=function(a){0!=this.xf_file[0].files.length&&(this.addfileobjectarray(this.xf_file[0].files),this.xf_file.val(""))},XF_UPLOADER.prototype.on_upload_progress=function(a){var b,c,d;if(b=a.data,a.originalEvent.lengthComputable)if(1==this.xf_prop.multi_upload)for(d=this.file_info_arr.length,c=0;d>c;c++)b=this.file_info_arr[c],b.upload_progress=Math.round(a.originalEvent.loaded/a.originalEvent.total*100),factory._fireevent({xf_component:this,event_name:"on_fileprogress",is_fire_async:!0},this,b.file_index,b.file_name,b.upload_progress);else b.upload_progress=Math.round(a.originalEvent.loaded/a.originalEvent.total*100),factory._fireevent({xf_component:this,event_name:"on_fileprogress",is_fire_async:!0},this,b.file_index,b.file_name,b.upload_progress)},XF_UPLOADER.prototype.on_upload_abort=function(a){var b,c,d;if(1==this.xf_prop.multi_upload)for(d=this.file_info_arr.length,c=0;d>c;c++)b=this.file_info_arr[c],this._setfilestatus(b,XF_UPLOADER.UPLOAD_STATUS_CANCEL,XF_UPLOADER.UPLOAD_RESULT_FAIL,"cancel",!0);else b=a.data,this._setfilestatus(b,XF_UPLOADER.UPLOAD_STATUS_CANCEL,XF_UPLOADER.UPLOAD_RESULT_FAIL,"cancel",!0)},XF_UPLOADER.prototype.on_upload_error=function(a){var b,c,d;if(1==this.xf_prop.multi_upload)for(d=this.file_info_arr.length,c=0;d>c;c++)b=this.file_info_arr[c],this._setfilestatus(b,XF_UPLOADER.UPLOAD_STATUS_DONE,XF_UPLOADER.UPLOAD_RESULT_FAIL,"error",!0);else b=a.data,this._setfilestatus(b,XF_UPLOADER.UPLOAD_STATUS_DONE,XF_UPLOADER.UPLOAD_RESULT_FAIL,"error",!0)},XF_UPLOADER.prototype.on_upload_timeout=function(a){var b,c,d;if(1==this.xf_prop.multi_upload)for(d=this.file_info_arr.length,c=0;d>c;c++)b=this.file_info_arr[c],this._setfilestatus(b,XF_UPLOADER.UPLOAD_STATUS_DONE,XF_UPLOADER.UPLOAD_RESULT_FAIL,"timeout",!0);else b=a.data,this._setfilestatus(b,XF_UPLOADER.UPLOAD_STATUS_DONE,XF_UPLOADER.UPLOAD_RESULT_FAIL,"timeout",!0)},XF_UPLOADER.prototype.on_upload_load=function(a){var b,c,d,e,f,g,h,i;if(g=a.target.response,i=this.file_info_arr.length,1==this.xf_prop.multi_upload)for(b=0;i>b;b++)c=this.file_info_arr[b],c.upload_status=XF_UPLOADER.UPLOAD_STATUS_DONE,c.upload_progress=100;else c=a.data,c.upload_status=XF_UPLOADER.UPLOAD_STATUS_DONE,c.upload_progress=100;for(d=!1,h=g.length,b=0;h>b;b++)if(""==g[b]){d=!0;break}if(0!=d){for(g=g.substr(b+1),b=g.length-1;b>=0&&""!=g[b];b--);if(g=g.substr(0,b),f=g.split(""),1==this.xf_prop.multi_upload)for(b=0;i>b;b++)c=this.file_info_arr[b],"success"==f[2*b]?(e=f[2*b+1].split("="),2==e.length&&(c.upload_file_name=e[1]),c.upload_result=XF_UPLOADER.UPLOAD_RESULT_SUCCESS,c.upload_message=""):"error"==f[2*b]&&(c.upload_result=XF_UPLOADER.UPLOAD_RESULT_FAIL,c.upload_message=f[2*b+1]),this._on_file_complete(c);else"success"==f[0]?(e=f[1].split("="),2==e.length&&(c.upload_file_name=e[1]),c.upload_result=XF_UPLOADER.UPLOAD_RESULT_SUCCESS,c.upload_message=""):"error"==f[0]&&(c.upload_result=XF_UPLOADER.UPLOAD_RESULT_FAIL,c.upload_message=f[1]),this._on_file_complete(c)}else if(1==this.xf_prop.multi_upload)for(b=0;i>b;b++)c=this.file_info_arr[b],c.upload_result=XF_UPLOADER.UPLOAD_RESULT_FAIL,c.upload_message=_xfu.trim(g),this._on_file_complete(c);else c.upload_result=XF_UPLOADER.UPLOAD_RESULT_FAIL,c.upload_message=_xfu.trim(g),this._on_file_complete(c)};