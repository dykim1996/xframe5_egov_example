/* 2020-10-30 18:04 */ function XF_RATINGBAR(a,b){this._init(a,b),_xfx.islistviewtemplate(this,b)||(this._prop(b),this._box())}XF_RATINGBAR.RATINGBAR_STEP_VAULE=[.5,1,2],XF_RATINGBAR.prototype._init=function(a,b){_xfx.init(this,a,XFD_OBJKIND_CONTROL,XFD_CTRLKIND_RATINGBAR,b),this.css_arr=[],this.select_pos=0,this.near_pos=0,this.near_value=0,this.is_default_hoverimg=!1},XF_RATINGBAR.prototype._prop=function(a){this.xf_prop={image_size:32,image_count:5,image_repeat:!0,reverse:!1,step_value:1,min_value:0,max_value:5,enable:!0,hidden:!1,click_setfocus:!1,dragable:!1,editable:!0,image_back:"",image_hover:"",image_select:"",image_hover_use:!0,default_value:0,default_value_usage:0},this.event_name_arr=["on_change","on_changed","on_click"],void 0===a.image_hover&&(this.is_default_hoverimg=!0),_xfx.propcommon(this,this.xf_prop,160,32),_xfx.propparam(this,this.xf_prop,a),_xfx.xdataset(this,!0),this._css(a)},XF_RATINGBAR.prototype._css=function(a){1!=_xf_htmlready_mode&&_xfx.propcss(this,a,this.css_arr,["position"])},XF_RATINGBAR.prototype._box=function(){var a;0==_xf_htmlready_mode&&(a=[],a.push("<div"),a.push(' id="'+this.xf_prop.internal_name+'"'),a.push(' class="'+_xfx.propclass(this,this.xf_prop,"_xf_ratingbar")+'"'),a.push(' style="'),a.push(this.css_arr.join("")),_xfx.sizeposcss(this,this.xf_prop,a),""!=this.xf_prop.image_back&&a.push("background:"+_xfx.imageurlfunc(this.xf_prop.image_back)+(1==this.xf_prop.image_repeat?";":" no-repeat;")),a.push('">'),a.push('<div class="_xf_ratingbar_select"'),a.push(' style="'),1==this.xf_prop.reverse?a.push("right:0px; "):a.push("left:0px; "),this.xf_prop.default_value>0&&this.xf_prop.image_size>0&&this.xf_prop.default_value<=this.xf_prop.max_value&&(this.select_pos=this.xf_prop.default_value*this.xf_prop.image_size,a.push("width:"+_xfu.px(this.select_pos)+"; display:block;")),""!=this.xf_prop.image_select&&a.push("background:"+_xfx.imageurlfunc(this.xf_prop.image_select)+(1==this.xf_prop.image_repeat?";":" no-repeat;")),a.push('">'),a.push("</div>"),a.push('<div class="_xf_ratingbar_hover"'),a.push(' style="'),1==this.xf_prop.reverse?a.push("right:0px; "):a.push("left:0px; "),a.push("width:"+_xfu.px(this.xf_prop.width)+"; display:none;"),""!==this.xf_prop.image_hover&&a.push("background:"+_xfx.imageurlfunc(this.xf_prop.image_hover)+(1==this.xf_prop.image_repeat?";":" no-repeat;")),a.push('">'),a.push("</div>"),a.push("</div>")),_xfx.register(this,!1,a)},XF_RATINGBAR.prototype._dom=function(){this.xf_ratingbar_select=this.xf_object.children("._xf_ratingbar_select"),this.xf_ratingbar_hover=this.xf_object.children("._xf_ratingbar_hover")},XF_RATINGBAR.prototype._offevent=function(){_xfj.offevent(this.xf_object,["mousedown","click","mousemove","mouseleave"]),_xfj.offevent(this.xf_object,["touchmove","touchend","touchcancel"])},XF_RATINGBAR.prototype._event=function(){this.xf_object.on("mousedown",$.proxy(this.on_ratingbar_mousedown,this)),this.xf_object.on("click",$.proxy(this.on_ratingbar_click,this)),this.xf_object.on("mousemove",$.proxy(this.on_ratingbar_mousemove,this)),this.xf_object.on("mouseleave",$.proxy(this.on_ratingbar_mouseleave,this)),this.xf_object.on("touchmove",$.proxy(this.on_ratingbar_touchmove,this)),this.xf_object.on("touchend",$.proxy(this.on_ratingbar_touchend,this)),this.xf_object.on("touchcancel",$.proxy(this.on_ratingbar_touchend,this))},XF_RATINGBAR.prototype._create=function(){this._dom(),this._data(),this._event()},XF_RATINGBAR.prototype._setvalue=function(a,b){this.value=a,isNaN(this.value)||this.value<this.xf_prop.min_value?this.value=this.xf_prop.min_value:this.value>this.xf_prop.max_value&&(this.value=this.xf_prop.max_value),this._ratingpos(this.value,b.is_click),1==b.is_set_xdataset&&this._setxdatasetvalue(_xfu.str(this.value)),b.is_fire_event&&factory._fireevent({xf_component:this,event_name:"on_changed",is_fire_async:!0},this,this.value)},XF_RATINGBAR.prototype._rangeareainit=function(){""!=this.xf_prop.image_back&&(this.xf_object.css({width:_xfu.px(this.xf_prop.width)}),this.xf_object.css({background:_xfx.imageurlfunc(this.xf_prop.image_back)+(1==this.xf_prop.image_repeat?"":" no-repeat")})),this._hoverareainit(),this._selectareainit()},XF_RATINGBAR.prototype._hoverareainit=function(){this.xf_ratingbar_hover.css({width:_xfu.px(this.xf_prop.width),display:"none"}),""!==this.xf_prop.image_hover&&this.xf_ratingbar_hover.css({background:_xfx.imageurlfunc(this.xf_prop.image_hover)+(1==this.xf_prop.image_repeat?"":" no-repeat")})},XF_RATINGBAR.prototype._selectareainit=function(){this.select_pos=this.value*this.xf_prop.image_size,this.xf_ratingbar_select.css({width:_xfu.px(this.select_pos),display:"block"}),""!==this.xf_prop.image_select&&this.xf_ratingbar_select.css({background:_xfx.imageurlfunc(this.xf_prop.image_select)+(1==this.xf_prop.image_repeat?"":" no-repeat")})},XF_RATINGBAR.prototype._ratingbarmove=function(a){var b,c,d,e;e=-1,b=parseInt(a-parseInt(this.xf_object.offset().left)),c=b/this.xf_object.outerWidth(),d=c*this.xf_object.width(),"none"!=this.xf_ratingbar_hover.css("display")&&(e=this.near_pos),this.near_pos=this._nearvalue(parseInt(d)),this.near_pos!=e&&0!=this.xf_prop.image_hover_use&&0!=this.xf_prop.editable&&(factory._fireevent({xf_component:this,event_name:"on_change",is_fire_async:!0},this,this.near_value),1!=this.is_default_hoverimg&&""===this.xf_prop.image_hover||b>0&&b<this.xf_prop.width&&(this.xf_ratingbar_select.css({display:"none"}),0==this.xf_prop.reverse?this.xf_ratingbar_hover.css({display:"block",width:_xfu.px(this.near_pos),"background-position-x":"0px"}):this.xf_ratingbar_hover.css({display:"block",width:_xfu.px(this.near_pos),"background-position-x":_xfu.px(this.near_pos-this.xf_prop.width)})))},XF_RATINGBAR.prototype._nearvalue=function(a){var b,c,d,e,f=[];if(this.xf_prop.image_size<=0||this.xf_prop.image_count<=0)return this.near_pos;for(c=0,d=XF_RATINGBAR.RATINGBAR_STEP_VAULE[this.xf_prop.step_value],e=this.xf_prop.image_size*d,b=e;b<this.xf_prop.width+1;b+=e)f.push(Number(b.toFixed(1)));if(this.xf_prop.width>f[f.length-1]&&(f[f.length-1]+e<this.xf_prop.width?f.push(f[f.length-1]+e):f.push(this.xf_prop.width)),f.unshift(0),0==this.xf_prop.reverse&&a>=0&&e/2>=a)c=0,b=0;else if(1==this.xf_prop.reverse&&a>=this.xf_prop.width-e/2&&a<=this.xf_prop.width)c=0,b=0;else for(b=0;b<f.length;b++)if(0==this.xf_prop.reverse){if(b>0&&a>=f[b-1]&&a<f[b]){c=f[b];break}}else if(b<f.length-1&&a>=f[b]&&a<f[b+1]){c=this.xf_prop.width-f[b],b=f.length-1-b;break}return b>=f.length?(this.near_value=this.xf_prop.max_value,c=this.xf_prop.width):this.near_value=Number((this.xf_prop.min_value+(this.xf_prop.max_value-this.xf_prop.min_value)/this.xf_prop.image_count*(b*d)).toFixed(1)),c},XF_RATINGBAR.prototype._ratingpos=function(a,b){var c,d;void 0===b&&(b=!1),this.xf_prop.image_size<=0||this.xf_prop.image_count<=0||(c=(this.xf_prop.max_value-this.xf_prop.min_value)/this.xf_prop.image_count,d=(a-this.xf_prop.min_value)*(this.xf_prop.width/this.xf_prop.image_count/c),this.select_pos=d,this.xf_ratingbar_hover.css({display:"none"}),1==this.xf_prop.reverse?this.xf_ratingbar_select.css({display:"block",width:_xfu.px(d),"background-position-x":_xfu.px(d-this.xf_prop.width)}):this.xf_ratingbar_select.css({display:"block",width:_xfu.px(d),"background-position-x":"0px"}))},XF_RATINGBAR.prototype.setminvalue=function(a){return a=_xfu.intval(a),a===!1||a>this.xf_prop.max_value?!1:(this.xf_prop.min_value=a,!0)},XF_RATINGBAR.prototype.getminvalue=function(){return this.xf_prop.min_value},XF_RATINGBAR.prototype.setmaxvalue=function(a){return a=_xfu.intval(a),a===!1||a<this.xf_prop.min_value?!1:(this.xf_prop.max_value=a,!0)},XF_RATINGBAR.prototype.getmaxvalue=function(){return this.xf_prop.max_value},XF_RATINGBAR.prototype.setstepvalue=function(a){return a=_xfu.intval(a,0,2),a===!1?!1:(this.xf_prop.step_value=a,!0)},XF_RATINGBAR.prototype.getstepvalue=function(){return this.xf_prop.step_value},XF_RATINGBAR.prototype.setvalue=function(a){return a=Number(Number(a).toFixed(1)),isNaN(a)||a<this.xf_prop.min_value||a>this.xf_prop.max_value?!1:(this._setvalue(a,{is_set_xdataset:!0,is_fire_event:!0}),!0)},XF_RATINGBAR.prototype.getvalue=function(){return this.value},XF_RATINGBAR.prototype.setimagerepeat=function(a,b,c){b=_xfu.intval(b),c=_xfu.intval(c),b===!1&&(b=this.xf_prop.image_count),c===!1&&(c=this.xf_prop.image_size),this.xf_prop.image_repeat=a,this.xf_prop.image_size=c,this.xf_prop.image_count=b,this.xf_prop.width=c*b,this._rangeareainit()},XF_RATINGBAR.prototype.getimagerepeat=function(){return this.xf_prop.image_repeat},XF_RATINGBAR.prototype.setimagesize=function(a){return a=_xfu.intval(a),a===!1?!1:(this.xf_prop.image_size=a,this.xf_prop.width=this.xf_prop.image_count*a,this._rangeareainit(),!0)},XF_RATINGBAR.prototype.getimagesize=function(){return this.xf_prop.image_size},XF_RATINGBAR.prototype.setimagecount=function(a){return a=_xfu.intval(a),a===!1?!1:(this.xf_prop.image_count=a,this.xf_prop.width=this.xf_prop.image_size*a,this._rangeareainit(),!0)},XF_RATINGBAR.prototype.getimagecount=function(){return this.xf_prop.image_count},XF_RATINGBAR.prototype.setreverse=function(a){this.xf_prop.reverse=a,0==this.xf_prop.reverse?(this.xf_ratingbar_hover.css({left:"0px",right:""}),this.xf_ratingbar_select.css({left:"0px",right:""})):(this.xf_ratingbar_hover.css({left:"",right:"0px"}),this.xf_ratingbar_select.css({left:"",right:"0px"})),this._ratingpos(this.value)},XF_RATINGBAR.prototype.getreverse=function(){return this.xf_prop.reverse},XF_RATINGBAR.prototype.setimageex=function(a,b,c){a.length>0&&(this.xf_prop.image_back=a),b.length>0&&(this.xf_prop.image_hover=b),c.length>0&&(this.xf_prop.image_select=c),this._rangeareainit()},XF_RATINGBAR.prototype.setbackimage=function(a){this.xf_prop.image_back=a,this._rangeareainit()},XF_RATINGBAR.prototype.getbackimage=function(){return this.xf_prop.image_back},XF_RATINGBAR.prototype.sethoverimage=function(a){this.xf_prop.image_hover=a,this.is_default_hoverimg=!1,this._hoverareainit()},XF_RATINGBAR.prototype.gethoverimage=function(){return this.xf_prop.image_hover},XF_RATINGBAR.prototype.setselectimage=function(a){this.xf_prop.image_select=a,this._selectareainit()},XF_RATINGBAR.prototype.getselectimage=function(){return this.xf_prop.image_select},XF_RATINGBAR.prototype.setusehover=function(a){this.xf_prop.image_hover_use=a,this._hoverareainit()},XF_RATINGBAR.prototype.getusehover=function(){return this.xf_prop.image_hover_use},XF_RATINGBAR.prototype.geteditable=function(){return this.xf_prop.editable},XF_RATINGBAR.prototype.seteditable=function(a){this.xf_prop.editable=a},XF_RATINGBAR.prototype.on_xdataset_event=function(a){_xfx.on_xdataset_event(this,a)},XF_RATINGBAR.prototype.on_ratingbar_mousemove=function(a){this.xf_prop.enable&&this._ratingbarmove(a.pageX)},XF_RATINGBAR.prototype.on_ratingbar_mouseleave=function(a){this.xf_prop.enable&&(this.xf_ratingbar_hover.css({display:"none"}),this.xf_ratingbar_select.css({display:"block",width:_xfu.px(this.select_pos)}))},XF_RATINGBAR.prototype.on_ratingbar_mousedown=function(a){this.xf_prop.enable&&0!=this.xf_prop.editable||0==this.xf_prop.click_setfocus&&a.preventDefault()},XF_RATINGBAR.prototype.on_ratingbar_click=function(a){this.xf_prop.enable&&1===a.which&&(factory._fireevent({xf_component:this,event_name:"on_click",is_fire_async:!0},this,this.near_value),1==this.xf_prop.editable&&this._setvalue(this.near_value,{is_fire_event:!0,is_set_xdataset:!0,is_click:!0}))},XF_RATINGBAR.prototype.on_ratingbar_touchmove=function(a,b){var c;return this.xf_prop.enable?(void 0===b&&(b=!1),c=_xfj.eventpagexy(a),1==b&&(c.x<this.xf_prop.x||c.x>this.xf_prop.x+this.xf_prop.width||c.y<this.xf_prop.y||c.y>this.xf_prop.y+this.xf_prop.height)?(this.xf_ratingbar_hover.css({display:"none"}),this.xf_ratingbar_select.css({display:"block",width:_xfu.px(this.select_pos)}),!0):(this._ratingbarmove(c.x),!1)):!1},XF_RATINGBAR.prototype.on_ratingbar_touchend=function(a){return this.xf_prop.enable?1==this.on_ratingbar_touchmove(a,!0)?!1:(factory._fireevent({xf_component:this,event_name:"on_click",is_fire_async:!0},this,this.near_value),1==this.xf_prop.editable&&this._setvalue(this.near_value,{is_fire_event:!0,is_set_xdataset:!0,is_click:!0}),!1):!1};