/* 2020-10-30 18:04 */ function XF_WEBSOCKET(a,b){this._init(a,b),this._prop(b),this._css(b),this._box()}XF_WEBSOCKET.prototype._init=function(a,b){_xfx.init(this,a,XFD_OBJKIND_CONTROL,XFD_CTRLKIND_WEBSOCKET,b),this.wsocket=null,this.is_connected=!1,this.sync_open_info=null,this.sync_sendrecv_info=null},XF_WEBSOCKET.prototype._prop=function(a){this.xf_prop={hidden:!0,tabstop:!1,enable:!0,apply_eventlock:!0,margin:[0,0,0,0]},this.event_name_arr=["on_open","on_message","on_error","on_close"],_xfx.propcommon(this,this.xf_prop),_xfx.propparam(this,this.xf_prop,a),this._css(a)},XF_WEBSOCKET.prototype._css=function(a){1!=_xf_htmlready_mode&&_xfx.propcss(this,a,this.css_arr,["position","hidden"])},XF_WEBSOCKET.prototype._box=function(){var a;0==_xf_htmlready_mode&&(a=[],a.push("<div"),a.push(' id="'+this.xf_prop.internal_name+'"'),a.push(' class="'+_xfx.propclass(this,this.xf_prop,"_xf_websocket")+'"'),a.push(' style="'),a.push(this.css_arr.join("")),_xfx.sizeposcss(this,this.xf_prop,a),a.push('">'),a.push("</div>")),_xfx.register(this,!1,a)},XF_WEBSOCKET.prototype._offevent=function(a){this.wsocket&&(_xfj.offevent($(this.wsocket),["open","message","error","close"]),a&&(this.wsocket=null))},XF_WEBSOCKET.prototype._event=function(){this.wsocket&&($(this.wsocket).on("open",$.proxy(this.on_object_open,this)),$(this.wsocket).on("message",$.proxy(this.on_object_message,this)),$(this.wsocket).on("error",$.proxy(this.on_object_error,this)),$(this.wsocket).on("close",$.proxy(this.on_object_close,this)))},XF_WEBSOCKET.prototype._create=function(){this._event(),factory._fireevent({xf_component:this,event_name:"on_create"},this)},XF_WEBSOCKET.prototype._opensynccomplete=function(a,b){this.sync_open_info.timer_id>=0&&(clearTimeout(this.sync_open_info.timer_id),this.sync_open_info.timer_id=-1),a?this.sync_open_info.promise_resolve(!0):this.sync_open_info.promise_reject(new Error(b)),this.sync_open_info=null,0==a&&this._offevent(!0)},XF_WEBSOCKET.prototype._sendrecvcomplete=function(a,b){this.sync_sendrecv_info.timer_id>=0&&(clearTimeout(this.sync_sendrecv_info.timer_id),this.sync_sendrecv_info.timer_id=-1),a?this.sync_sendrecv_info.promise_resolve(b):this.sync_sendrecv_info.promise_reject(new Error(b)),this.sync_sendrecv_info=null},XF_WEBSOCKET.prototype.eventlock=function(a,b){1==this.xf_prop.apply_eventlock&&(this.is_event_locked=a,b===!0&&(this.is_event_locked_subscreen=a))},XF_WEBSOCKET.prototype.setapplyeventlock=function(a){this.xf_prop.apply_eventlock=a},XF_WEBSOCKET.prototype.open=function(a){this.wsocket=new WebSocket(a),this._event()},XF_WEBSOCKET.prototype.opensync=function(a,b){return this.sync_open_info={url:a,timeout_ms:b,timer_id:-1,promise_resolve:null,promise_reject:null},new Promise(this.opensync_executor.bind(this))},XF_WEBSOCKET.prototype.opensync_executor=function(a,b){this.sync_open_info.promise_resolve=a,this.sync_open_info.promise_reject=b,void 0!==this.sync_open_info.timeout_ms&&(this.sync_open_info.timeout_ms=_xfu.intval(this.sync_open_info.timeout_ms,1,XFD_MAX_VALUE),this.sync_open_info.timeout_ms!==!1&&(this.sync_open_info.timer_id=window.setTimeout($.proxy(this.on_opensync_timeout,this),this.sync_open_info.timeout_ms))),this.open(this.sync_open_info.url)},XF_WEBSOCKET.prototype.on_opensync_timeout=function(a){return this.sync_open_info&&this.sync_open_info.promise_resolve?void this._opensynccomplete(!1,"websocket timeout"):void 0},XF_WEBSOCKET.prototype.send=function(a){if(null==this.wsocket||0==this.is_connected)return!1;try{this.wsocket.send(a)}catch(b){return!1}return!0},XF_WEBSOCKET.prototype.sendrecv=function(a,b){return this.sync_sendrecv_info={send_data:a,timeout_ms:b,timer_id:-1,promise_resolve:null,promise_reject:null},new Promise(this.sendrecv_executor.bind(this))},XF_WEBSOCKET.prototype.sendrecv_executor=function(a,b){return this.sync_sendrecv_info.promise_resolve=a,this.sync_sendrecv_info.promise_reject=b,void 0!==this.sync_sendrecv_info.timeout_ms&&(this.sync_sendrecv_info.timeout_ms=_xfu.intval(this.sync_sendrecv_info.timeout_ms,1,XFD_MAX_VALUE),this.sync_sendrecv_info.timeout_ms!==!1&&(this.sync_sendrecv_info.timer_id=window.setTimeout($.proxy(this.on_sendrecv_timeout,this),this.sync_sendrecv_info.timeout_ms))),this.sync_sendrecv_info&&this.sync_sendrecv_info.promise_resolve&&(null==this.wsocket||0==this.is_connected)?(this.sync_sendrecv_info.promise_reject(new Error("websocket is closed")),void(this.sync_sendrecv_info=null)):void this.wsocket.send(this.sync_sendrecv_info.send_data)},XF_WEBSOCKET.prototype.on_sendrecv_timeout=function(a){return this.sync_sendrecv_info&&this.sync_sendrecv_info.promise_resolve?void this._sendrecvcomplete(!1,"websocket timeout"):void 0},XF_WEBSOCKET.prototype.close=function(){return null==this.wsocket||0==this.is_connected?!1:(this.wsocket.close(),!0)},XF_WEBSOCKET.prototype.getreadstate=function(){return null==this.wsocket?0:this.wsocket.readyState},XF_WEBSOCKET.prototype.getprotocol=function(){return null==this.wsocket?"":this.wsocket.protocol},XF_WEBSOCKET.prototype.getbufferedamount=function(){return null==this.wsocket?0:this.wsocket.bufferedAmount},XF_WEBSOCKET.prototype.on_object_open=function(a){return this.is_connected=!0,this.sync_open_info&&this.sync_open_info.promise_resolve?void this._opensynccomplete(!0):void factory._fireevent({xf_component:this,event_name:"on_open",is_fire_async:!0},this)},XF_WEBSOCKET.prototype.on_object_message=function(a){return this.sync_sendrecv_info&&this.sync_sendrecv_info.promise_resolve?void this._sendrecvcomplete(!0,a.originalEvent.data):void factory._fireevent({xf_component:this,event_name:"on_message",is_fire_async:!0},this,a.originalEvent.data)},XF_WEBSOCKET.prototype.on_object_error=function(a){return this.sync_open_info&&this.sync_open_info.promise_resolve?void this._opensynccomplete(!1,"websocket error"):this.sync_sendrecv_info&&this.sync_sendrecv_info.promise_resolve?void this._sendrecvcomplete(!1,"websocket error"):void factory._fireevent({xf_component:this,event_name:"on_error",is_fire_async:!0},this)},XF_WEBSOCKET.prototype.on_object_close=function(a){return this.is_connected=!1,this.sync_open_info&&this.sync_open_info.promise_resolve?void this._opensynccomplete(!1,"websocket error"):(this.sync_sendrecv_info&&this.sync_sendrecv_info.promise_resolve&&this._sendrecvcomplete(!1,"websocket closed"),this._offevent(!0),void factory._fireevent({xf_component:this,event_name:"on_close",is_fire_async:!0},this,a.originalEvent.code,a.originalEvent.reason,a.originalEvent.wasClean))};