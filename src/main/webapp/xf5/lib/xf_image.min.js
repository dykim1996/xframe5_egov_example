/* 2020-10-30 18:04 */ function XF_IMAGE(a,b){this._init(a,b),_xfx.islistviewtemplate(this,b)||(this._prop(b),this._box())}XF_IMAGE.IMAGE_DATA_URL=0,XF_IMAGE.IMAGE_DATA_INDEX=1,XF_IMAGE.IMAGE_DATA_DATAURL=2,XF_IMAGE.prototype._init=function(a,b){var c,d;c=XFD_OBJKIND_CONTROL,d=XFD_CTRLKIND_IMAGE,void 0!==b.object_kind&&(c=b.object_kind,b.object_kind==XFD_OBJKIND_SHAPE&&(d=XFD_SHAPEKIND_IMAGE)),_xfx.init(this,a,c,d,b),this.download_jsp="",this.xf_iframe=null,this.file_object=null},XF_IMAGE.prototype._prop=function(a){this.xf_prop={style:"",custom_class:"",back_color:[255,255,255],back_color_opacity:10,transparent:!0,border:1,border_color:[180,180,180],border_radius:"0",border_width:1,back_image:"",back_imagesize:0,back_imagehorzalign:0,back_imagevertalign:0,back_imagefillstyle:0,horz_align:0,vert_align:0,gradient_effect:0,gradient_startcolor:[255,255,255],gradient_endcolor:[225,225,225],boxshadow_type:0,padding:[0,0,0,0],image_datatype:0,image_list:"",enable:!0,image:"",imagesize:0,max_width_percent:0,hidden:!1,click_setfocus:!1,resize_handle:0,opacity:10,resize_dir:0,mouse_cursor:0,accept_drop:!1,dragable:!1,default_image_usage:0,tooltip:"",image_width:0,image_height:0},this.event_name_arr=["on_mousein","on_mouseout","on_click","on_dblclick","on_begindrag","on_enddrag","on_dropcomplete","on_dragenter","on_dragleave","on_imagedata","on_selectimage"],void 0!==a.border_width&&(a.border_width=_xfu["int"](a.border_width)+1),_xfx.propcommon(this,this.xf_prop),_xfx.propparam(this,this.xf_prop,a),0==this.xf_prop.image_list.length?this.xf_prop.image_list=[]:this.xf_prop.image_list=this.xf_prop.image_list.split(","),_xfx.xdataset(this,!0),this._css(a)},XF_IMAGE.prototype._css=function(a){1!=_xf_htmlready_mode&&(_xfx.propcss(this,a,this.css_arr,["position","border","border_color","border_width","border_radius","mouse_cursor","hidden","opacity","padding","back_imagesize","back_imagefillstyle"]),_xfx.propbackcolor(this,a,this.css_arr),_xfx.propgradient(this,a,this.css_arr),_xfx.propbackimagepos(this,a,this.css_arr),_xfx.propflexalign(this,a,this.css_arr))},XF_IMAGE.prototype._box=function(){var a;0==_xf_htmlready_mode&&(a=[],a.push("<div"),a.push(' id="'+this.xf_prop.internal_name+'"'),a.push(' class="'+_xfx.propclass(this,this.xf_prop,"_xf_img")+'"'),1==this.xf_prop.dragable&&a.push(' draggable="true"'),this.xf_prop.description.length>0&&a.push(' alt="'+this.xf_prop.description+'"'),this.xf_prop.tooltip.length>0&&a.push(' title="'+_xfu.quot(this.xf_prop.tooltip)+'"'),a.push(' style="'),a.push(this.css_arr.join("")),_xfx.sizeposcss(this,this.xf_prop,a),a.push('">'),a.push('<img class="_xf_img_img'),this.xf_prop.custom_class.length>0&&a.push(" "+this.xf_prop.custom_class),a.push('"'),a.push(' style="'),this.xf_prop.max_width_percent>0&&a.push("max-width:"+_xfu.pc(this.xf_prop.max_width_percent)+";"),a.push(this._imagesize(null)),a.push('">'),a.push("</div>")),_xfx.register(this,!1,a)},XF_IMAGE.prototype._dom=function(){this.xf_image=this.xf_object.find("img"),0!==this.xf_prop.resize_handle&&(this.xf_resize=new XF_RESIZE(this,{resize_handle:this.xf_prop.resize_handle}))},XF_IMAGE.prototype._data=function(){var a;this.xdataset_column_type==XFD_XDATASET_COLUMN_INNER?this._setvalue(this.xf_prop.image,{is_set_xdataset:!0,event_type:XFD_DATA_CHANGE_BY_API,is_display_value:!0}):(a=_xfx.defaultvalueinfo(this,this.xf_prop.image),this._setvalue(a.default_value,{is_set_xdataset:a.is_set_xdataset,event_type:a.is_set_xdataset?XFD_DATA_CHANGE_BY_API:XFD_DATA_CHANGE_BY_XDATASET,is_display_value:!0}))},XF_IMAGE.prototype._offevent=function(){_xfj.offevent(this.xf_object,["mousedown","click","dblclick","mouseenter","mouseleave"]),_xfj.offevent(this.xf_object,["dragstart","dragend"]),_xfj.offevent(this.xf_object,["dragover","drop","dragenter","dragleave"]),_xfj.offevent(this.xf_object,["touchstart","touchmove","touchend","touchcancel"]),_xfj.offevent(this.xf_image,["load"])},XF_IMAGE.prototype._event=function(){this.xf_object.on("mousedown",$.proxy(this.on_object_mousedown,this)),this.xf_object.on("click",$.proxy(this.on_object_click,this)),this.xf_object.on("dblclick",$.proxy(this.on_object_dblclick,this)),this.xf_object.on("mouseenter",$.proxy(this.on_object_mouseenter,this)),this.xf_object.on("mouseleave",$.proxy(this.on_object_mouseleave,this)),this.xf_object.on("dragstart",$.proxy(this.on_object_dragstart,this)),this.xf_object.on("dragend",$.proxy(this.on_object_dragend,this)),this.xf_object.on("dragover",$.proxy(this.on_object_dragover,this)),this.xf_object.on("drop",$.proxy(this.on_object_drop,this)),this.xf_object.on("dragenter",$.proxy(this.on_object_dragenter,this)),this.xf_object.on("dragleave",$.proxy(this.on_object_dragleave,this)),this.xf_object.on("touchstart",$.proxy(this.on_object_touchstart,this)),this.xf_object.on("touchmove",$.proxy(this.on_object_touchmove,this)),this.xf_object.on("touchend",$.proxy(this.on_object_touchend,this)),this.xf_object.on("touchcancel",$.proxy(this.on_object_touchend,this)),this.xf_image.on("load",$.proxy(this.on_image_load,this))},XF_IMAGE.prototype._create=function(){this._dom(),this._data(),this._event()},XF_IMAGE.prototype.on_image_load=function(a){var b;b=_xfj.imagesize(this.xf_image),this.xf_prop.image_width=b.image_width,this.xf_prop.image_height=b.image_height},XF_IMAGE.prototype.on_object_mousedown=function(a){factory.registermouseevent(this,a),0==this.xf_prop.dragable&&0==this.xf_prop.click_setfocus&&a.preventDefault()},XF_IMAGE.prototype.on_object_click=function(a){factory.registermouseevent(this,a),factory._fireevent({xf_component:this,event_name:"on_click",is_fire_async:!0},this)},XF_IMAGE.prototype.on_object_dblclick=function(a){factory.registermouseevent(this,a),factory._fireevent({xf_component:this,event_name:"on_dblclick",is_fire_async:!0},this)},XF_IMAGE.prototype.on_object_mouseenter=function(a){factory._fireevent({xf_component:this,event_name:"on_mousein",is_fire_async:!0},this)},XF_IMAGE.prototype.on_object_mouseleave=function(a){factory._fireevent({xf_component:this,event_name:"on_mouseout",is_fire_async:!0},this)},XF_IMAGE.prototype.on_object_touchstart=function(a){var b;0!=this.xf_prop.dragable&&(b=_xfj.eventpagexy(a),this.touchstart_page_x=b.x,this.touchstart_page_y=b.y,this.touchstart_prop_x=this.xf_prop.x,this.touchstart_prop_y=this.xf_prop.y,this.is_first_touchmove=!0,this.is_touch_draggble=!0,this.touchstart_zindex=this.xf_object.css("z-index"))},XF_IMAGE.prototype.on_object_touchmove=function(a,b){var c,d,e,f;if(0!=this.xf_prop.dragable&&0!=this.is_touch_draggble){if(1==this.is_first_touchmove){if(a.preventDefault(),this.is_first_touchmove=!1,f=factory._firedragstartevent(this,a),f===!1)return void(this.is_touch_draggble=!1);this.xf_clone_object&&this.xf_clone_object.remove(),this.xf_clone_object=this.xf_object.clone(!1),this.xf_clone_object.css("opacity","0.5"),this.xf_clone_object.appendTo(this.xf_object.parent()),this.xf_clone_object.css("z-index",this.xf_parent.xf_content.last_control_zindex+1)}return c=_xfj.eventpagexy(a),d=this.touchstart_prop_x+(c.x-this.touchstart_page_x),e=this.touchstart_prop_y+(c.y-this.touchstart_page_y),this.xf_clone_object.css({left:d,top:e}),!1}},XF_IMAGE.prototype.on_object_touchend=function(a){return 0!=this.xf_prop.dragable&&0!=this.is_touch_draggble?(this.on_object_touchmove(a,!0),this.xf_clone_object&&this.xf_clone_object.remove(),factory._firedragendevent(this,a),!1):void 0},XF_IMAGE.prototype.on_object_dragstart=function(a){return factory._firedragstartevent(this,a)},XF_IMAGE.prototype.on_object_dragend=function(a){return factory._firedragendevent(this,a)},XF_IMAGE.prototype.on_object_dragover=function(a){1==this.xf_prop.accept_drop&&a.preventDefault()},XF_IMAGE.prototype.on_object_dragenter=function(a){1==this.xf_prop.accept_drop&&a.preventDefault(),factory._fireevent({xf_component:this,event_name:"on_dragenter"},this,factory.xf_main_factory.xf_drag.xf_screen,factory.xf_main_factory.xf_drag.xf_component)},XF_IMAGE.prototype.on_object_dragleave=function(a){1==this.xf_prop.accept_drop&&a.preventDefault(),factory._fireevent({xf_component:this,event_name:"on_dragleave"},this,factory.xf_main_factory.xf_drag.xf_screen,factory.xf_main_factory.xf_drag.xf_component)},XF_IMAGE.prototype.on_object_drop=function(a){var b;if(a.preventDefault(),0==this.xf_prop.accept_drop)return!1;if(b=a.originalEvent.dataTransfer.files.length,1==b){if(a.originalEvent.dataTransfer.files[0].type.indexOf("image")<0)return;return this.select_file_object=a.originalEvent.dataTransfer.files[0],this.xf_prop.image=a.originalEvent.dataTransfer.files[0].name,this._readimagefile(a.originalEvent.dataTransfer.files[0],this.xf_image_file),void factory._fireevent({xf_component:this,event_name:"on_selectimage",is_fire_async:!0},this,this.xf_prop.image,this.select_file_object)}0==b&&(factory._fireevent({xf_component:this,event_name:"on_dropcomplete"},this,factory.xf_main_factory.xf_drag.xf_screen,factory.xf_main_factory.xf_drag.xf_component),factory._resetdraginfo())},XF_IMAGE.prototype.on_xdataset_event=function(a){_xfx.on_xdataset_event(this,a)},XF_IMAGE.prototype._getvalue=function(){return _xfx.getvalue(this)},XF_IMAGE.prototype._setvalue=function(a,b){1==b.is_set_xdataset&&this._setxdatasetvalue(_xfu.str(a)),1==b.is_display_value&&this._displayimage(a)},XF_IMAGE.prototype._setxdatasetvalue=function(a){_xfx.setxdatasetvalue(this,a)},XF_IMAGE.prototype._displayimage=function(a){var b,c,d;return void 0===a?!1:(this.xf_prop.image_width=0,this.xf_prop.image_height=0,this.xf_image?this.xf_prop.image_datatype==XF_IMAGE.IMAGE_DATA_DATAURL?(d=a,0==d.length?(this.xf_image.removeAttr("src"),!0):("data"==d.substr(0,4)?this.xf_image.attr("src",d):this.xf_image.attr("src","data:image/all;base64,"+d),!0)):(b=a,this.xf_prop.image_datatype==XF_IMAGE.IMAGE_DATA_INDEX&&(c=_xfu.intval(a,0,this.xf_prop.image_list),b=c===!1?"":this.xf_prop.image_list[c]),0==b.length?this.xf_image.removeAttr("src"):this.xf_image.attr("src",_xfx.imageurl(b)),!0):void 0)},XF_IMAGE.prototype._readimagefile=function(a,b){var c,d,e;return"undefined"==typeof FileReader?void alert("This browser does not support HTML5."):(d=new FileReader,c=$(d),e=this.xf_image,c.on("load",function(a){e.attr("src",a.target.result),void 0!==b&&null!=b&&b.val("")}),void d.readAsDataURL(a))},XF_IMAGE.prototype.destroy=function(){this._offevent(),void 0!==this.xf_resize&&this.xf_resize.destroy(),this.xf_image.remove(),this.xf_object.remove(),_xfx.unregister(this)},XF_IMAGE.prototype.getimage=function(){return this._getvalue()},XF_IMAGE.prototype.setimage=function(a){return void 0===a?!1:(this.xdataset_column_type==XFD_XDATASET_COLUMN_INNER&&(this.xf_prop.image_datatype=XF_IMAGE.IMAGE_DATA_URL),this._setvalue(a,{is_set_xdataset:!0,is_display_value:!0}),!0)},XF_IMAGE.prototype.setimagedata=function(a){return void 0===a?!1:(this.xdataset_column_type==XFD_XDATASET_COLUMN_INNER&&(this.xf_prop.image_datatype=XF_IMAGE.IMAGE_DATA_DATAURL),this._setvalue(a,{is_set_xdataset:!0,is_display_value:!0}),!0)},XF_IMAGE.prototype.getimageindex=function(){return this._getvalue()},XF_IMAGE.prototype.setimageindex=function(a){return a=_xfu.intval(a,0,this.xf_prop.image_list),a===!1?!1:(this.xdataset_column_type==XFD_XDATASET_COLUMN_INNER&&(this.xf_prop.image_datatype=XF_IMAGE.IMAGE_DATA_INDEX),this._setvalue(a,{is_set_xdataset:!0,is_display_value:!0}),!0)},XF_IMAGE.prototype.getimagelist=function(){return this.xf_prop.image_list},XF_IMAGE.prototype.setimagelist=function(a){return this.xf_prop.image_list=a,this.settext(this.gettext()),!0},XF_IMAGE.prototype.getimagedata=function(){return this._getimagedata(!1)},XF_IMAGE.prototype.getimagedataurl=function(){return this._getimagedata(!0)},XF_IMAGE.prototype._getimagedata=function(a){var b,c,d,e,f,g,h,i,j;return this.xdataset_column_type!==XFD_XDATASET_COLUMN_INNER?(g=this._getvalue(),a===!0?g:"data"==g.substr(0,4)?(h=g.indexOf(","),-1==h?g:i=g.substr(h+1)):g):(j=[],b=this.xf_image.outerWidth(),c=this.xf_image.outerHeight(),j.push("<canvas "),j.push(' width="'+b+'"'),j.push(' height="'+c+'"'),j.push(' style="'),j.push("position:absolute;left:0px;top:0px;"),j.push("display:none;"),j.push('"'),j.push("></canvas>"),e=$(j.join("")),this.xf_object.append(e),d=e[0],f=d.getContext("2d"),f.drawImage(this.xf_image[0],0,0,b,c),g=d.toDataURL(),e.remove(),a===!0?g:(h=g.indexOf(","),i=g.substr(h+1)))},XF_IMAGE.prototype.selectlocalimage=function(){void 0===this.xf_image_file&&(this.xf_image_file=$('<input type="file" accept="image/*" style="display:none;">'),this.xf_object.append(this.xf_image_file),this.xf_image_file.on("change",$.proxy(this.on_imagefile_change,this)),this.xf_image_file.on("click",$.proxy(this.on_imagefile_click,this))),this.xf_image_file.get(0).click()},XF_IMAGE.prototype.on_imagefile_click=function(a){a.stopPropagation()},XF_IMAGE.prototype.on_imagefile_change=function(a){var b;b=this.xf_image_file.val(),0!=b.length&&(this.select_file_object=this.xf_image_file[0].files[0],this.xf_prop.image=this.xf_image_file[0].files[0].name,this._readimagefile(this.xf_image_file[0].files[0],this.xf_image_file),factory._fireevent({xf_component:this,event_name:"on_selectimage",is_fire_async:!0},this,this.xf_prop.image,this.select_file_object))},XF_IMAGE.prototype.getimagefillstyle=function(){return this.xf_prop.image_fillstyle},XF_IMAGE.prototype.setimagefillstyle=function(a){this.xf_prop.image_fillstyle=_xfu["int"](a),_xfc.basic("image_fillstyle",this.xf_prop.image_fillstyle,!0,this.xf_object)},XF_IMAGE.prototype.getimageheight=function(){return this.xf_prop.image_height},XF_IMAGE.prototype.getimagewidth=function(){return this.xf_prop.image_width},XF_IMAGE.prototype.getimagesize=function(){return this.xf_prop.imagesize},XF_IMAGE.prototype.setimagesize=function(a){return a=_xfu.intval(a,0,5),a===!1?!1:(this.xf_prop.imagesize=a,void this._imagesize(this.xf_image))},XF_IMAGE.prototype._imagesize=function(a){switch(this.xf_prop.imagesize){case 0:if(null==a)return"width:auto;height:auto;";this.xf_image.css({width:"auto",height:"auto"});break;case 1:if(null==a)return"width:100%;height:100%;";this.xf_image.css({width:"100%",height:"100%"});break;case 2:if(null==a)return"width:auto;height:auto;";this.xf_image.css({width:"auto",height:"auto"});break;case 4:if(null==a)return"width:100%;max-height:100%;";this.xf_image.css({width:"100%",maxHeight:"100%"});break;case 5:if(null==a)return"max-width:100%;height:100%;";this.xf_image.css({maxWidth:"100%",height:"100%"})}},XF_IMAGE.prototype.getresizehandle=function(){return this.xf_prop.resize_handle},XF_IMAGE.prototype.setresizehandle=function(a){return a=_xfu.intval(a,0,3),a===!1?!1:(this.xf_prop.resize_handle=a,void 0===this.xf_resize&&0!==a&&(this.xf_resize=new XF_RESIZE(this,{resize_handle:a})),void 0!==this.xf_resize&&this.xf_resize.setresizehandle(this.xf_prop.resize_handle),!0)},XF_IMAGE.prototype.setdownloadserverpage=function(a){this.download_jsp=a},XF_IMAGE.prototype.savefile=function(a){var b,c,d;return b=this.xf_object.attr("src").replace(/.*\s?url\([\'\"]?/,"").replace(/[\'\"]?\).*/,""),c=new RegExp("^http[s]?:\\/\\/(www\\.)?"),c.test(b)||(b=factory.xf_param.IMAGEBASEURL+b),null==this.xf_iframe&&(this.xf_iframe=$('<iframe style="display:none" src=""/>'),$(document.body).append(this.xf_iframe)),d=this.download_jsp+"?SavingFileName="+encodeURI(a)+"&FileURI="+encodeURI(b),this.xf_iframe.prop("src",d),!0},XF_IMAGE.prototype.movetodragend=function(){return void 0===this.drag_start_page_x||void 0===this.drag_start_page_y?!1:void 0===this.drag_end_page_x||void 0===this.drag_end_page_y?!1:(this.xf_prop.x=this.getleft()+(this.drag_end_page_x-this.drag_start_page_x),this.xf_prop.y=this.gettop()+(this.drag_end_page_y-this.drag_start_page_y),this.xf_prop.x<0&&(this.xf_prop.x=0),this.xf_prop.y<0&&(this.xf_prop.y=0),this.xf_object.css({left:_xfu.px(this.xf_prop.x),top:_xfu.px(this.xf_prop.y)}),!0)},XF_IMAGE.prototype.getbackimage=function(){return this.xf_prop.back_image},XF_IMAGE.prototype.setbackimage=function(a){this.xf_prop.back_image=a,0!==this.xf_prop.gradient_effect?_xfc.gradient(this.xf_object,this.xf_prop.gradient_effect,this.xf_prop.gradient_startcolor,this.xf_prop.gradient_endcolor,this.xf_prop.back_image):_xfc.basic("back_image",this.xf_prop.back_image,!0,this.xf_object)},XF_IMAGE.prototype.getselectfileobject=function(){return this.select_file_object};