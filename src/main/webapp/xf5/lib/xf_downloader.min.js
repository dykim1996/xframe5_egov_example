/* 2020-10-30 18:04 */ function XF_DOWNLOADER(a,b){this._init(a,b),this._prop(b),this._box()}XF_DOWNLOADER.DOWNLOAD_STATUS_NONE=1,XF_DOWNLOADER.DOWNLOAD_STATUS_WAIT=2,XF_DOWNLOADER.DOWNLOAD_STATUS_ING=3,XF_DOWNLOADER.DOWNLOAD_STATUS_CANCEL=4,XF_DOWNLOADER.DOWNLOAD_STATUS_DONE=9,XF_DOWNLOADER.DOWNLOAD_RESULT_SUCCESS=1,XF_DOWNLOADER.DOWNLOAD_RESULT_FAIL=0,XF_DOWNLOADER.prototype._init=function(a,b){_xfx.init(this,a,XFD_OBJKIND_CONTROL,XFD_CTRLKIND_DOWNLOADER,b),this.is_stop_download=!1,this.is_downloading=!1,this.file_info_arr=[]},XF_DOWNLOADER.prototype._prop=function(a){this.xf_prop={url:"",serial_download:!1,async_download:!0,allow_multifile:!0,enable:!0,hidden:!0,enterstop:!0,tabstop:!0,with_credentials:!0},this.event_name_arr=["on_downloadcomplete","on_fileprogress","on_filecomplete","on_listupdate","on_fileadd","on_filedelete"],_xfx.propcommon(this,this.xf_prop),_xfx.propparam(this,this.xf_prop,a),this._css(a)},XF_DOWNLOADER.prototype._css=function(a){1!=_xf_htmlready_mode&&_xfx.propcss(this,a,this.css_arr,["position","hidden"])},XF_DOWNLOADER.prototype._box=function(){var a;0==_xf_htmlready_mode&&(a=[],a.push("<div"),a.push(' id="'+this.xf_prop.internal_name+'"'),a.push(' class="'+_xfx.propclass(this,this.xf_prop,"_xf_downloader")+'"'),a.push(' style="'),a.push(this.css_arr.join("")),_xfx.sizeposcss(this,this.xf_prop,a),a.push('">'),a.push("</div>")),_xfx.register(this,!1,a)},XF_DOWNLOADER.prototype._dom=function(){},XF_DOWNLOADER.prototype._offevent=function(){},XF_DOWNLOADER.prototype._event=function(){},XF_DOWNLOADER.prototype._create=function(){this._dom(),this._event()},XF_DOWNLOADER.prototype._mergefileinfoarr=function(a){var b,c,d,e;for(d=a.length,b=0;d>b;b++){for(e=this.file_info_arr.length,c=0;e>c&&a[b].file_name!=this.file_info_arr[c].file_name;c++);c==e&&(this.file_info_arr.push(a[b]),this._resetfileindex(),factory._fireevent({xf_component:this,event_name:"on_fileadd",is_fire_async:!0},this,a[b].file_index,a[b].file_name))}this._resetfileindex(),_xfu.async({context:this,func:this._on_list_update})},XF_DOWNLOADER.prototype._createfileinfo=function(a,b){var c;return c={url:a,file_index:-1,file_object:null,file_name:b,file_size:0,file_mime_type:"",file_last_modified:new Date,file_modified_date:"",file_modified_time:"",file_brief_size:"0KB",download_status:XF_DOWNLOADER.DOWNLOAD_STATUS_NONE,download_result:XF_DOWNLOADER.DOWNLOAD_RESULT_FAIL,download_message:"",download_progress:0,xhr:null,post_data:{},xf_anchor:null}},XF_DOWNLOADER.prototype._getfilebriefsize=function(a){var b,c,d,e=["KB","MB","GB","TB","PB","EB","ZB","YB"];for(b=0,d=a+"B",c=a/1024;c>=1;c/=1024,b++)d=c.toFixed(0)+e[b];return d},XF_DOWNLOADER.prototype._resetfileindex=function(){var a,b;for(b=this.file_info_arr.length,a=0;b>a;a++)this.file_info_arr[a].file_index=a},XF_DOWNLOADER.prototype._setfilestatus=function(a,b,c,d,e){a.download_status=b,a.download_result=c,a.download_message=d,e&&this._on_file_complete(a)},XF_DOWNLOADER.prototype._downloadonefile=function(a){var b,c,d;if(null===a)return!0;if(a.download_status=XF_DOWNLOADER.DOWNLOAD_STATUS_ING,b=new FormData,a.xhr=new XMLHttpRequest,c=0==a.url.length?this.xf_prop.url:a.url,a.post_data)for(d in a.post_data)b.append(d,a.post_data[d]);a.post_data?a.xhr.open("POST",c,this.xf_prop.async_download):a.xhr.open("GET",c,this.xf_prop.async_download),a.xhr.withCredentials=this.xf_prop.with_credentials,a.xhr.responseType="blob",$(a.xhr).on("load",a,$.proxy(this.on_download_load,this)),$(a.xhr).on("error",a,$.proxy(this.on_download_error,this)),$(a.xhr).on("abort",a,$.proxy(this.on_download_abort,this)),$(a.xhr).on("timeout",a,$.proxy(this.on_download_timeout,this)),$(a.xhr).on("progress",a,$.proxy(this.on_download_progress,this)),a.post_data?a.xhr.send(b):a.xhr.send()},XF_DOWNLOADER.prototype._on_list_update=function(){factory._fireevent({xf_component:this,event_name:"on_listupdate",is_fire_async:!0},this)},XF_DOWNLOADER.prototype._on_download_complete=function(){this.is_downloading=!1,factory._fireevent({xf_component:this,event_name:"on_downloadcomplete",is_fire_async:!0},this)},XF_DOWNLOADER.prototype._on_file_complete=function(a){var b,c;if(factory._fireevent({xf_component:this,event_name:"on_filecomplete",is_fire_async:!0},this,a.file_index,a.file_name),this.file_info_index++,this.is_stop_download&&this.xf_prop.serial_download){for(c=this.file_info_arr.length,b=this.file_info_index;c>b;b++)this.file_info_arr[b].download_status=XF_DOWNLOADER.DOWNLOAD_STATUS_CANCEL,this.file_info_arr[b].download_result=XF_DOWNLOADER.DOWNLOAD_RESULT_FAIL;this.file_info_index=c}return this.file_info_index<this.file_info_arr.length&&this.xf_prop.serial_download?void this._downloadonefile(this.file_info_arr[this.file_info_index]):void(this.file_info_index>=this.file_info_arr.length&&_xfu.async({context:this,func:this._on_download_complete}))},XF_DOWNLOADER.prototype.on_download_progress=function(a){var b;b=a.data,a.originalEvent.lengthComputable&&(b.download_progress=Math.round(a.originalEvent.loaded/a.originalEvent.total*100),b.file_size=a.originalEvent.total,b.file_brief_size=this._getfilebriefsize(b.file_size),factory._fireevent({xf_component:this,event_name:"on_fileprogress",is_fire_async:!0},this,b.file_index,b.file_name,b.download_progress))},XF_DOWNLOADER.prototype.on_download_abort=function(a){var b;b=a.data,this._setfilestatus(b,XF_DOWNLOADER.DOWNLOAD_STATUS_CANCEL,XF_DOWNLOADER.DOWNLOAD_RESULT_FAIL,"cancel",!0)},XF_DOWNLOADER.prototype.on_download_error=function(a){var b;b=a.data,this._setfilestatus(b,XF_DOWNLOADER.DOWNLOAD_STATUS_DONE,XF_DOWNLOADER.DOWNLOAD_RESULT_FAIL,"error",!0)},XF_DOWNLOADER.prototype.on_download_timeout=function(a){var b;b=a.data,this._setfilestatus(b,XF_DOWNLOADER.DOWNLOAD_STATUS_DONE,XF_DOWNLOADER.DOWNLOAD_RESULT_FAIL,"timeout",!0)},XF_DOWNLOADER.prototype.on_download_load=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;c=a.target.response,b=a.data,b.download_status=XF_DOWNLOADER.DOWNLOAD_STATUS_DONE,b.download_progress=100,200==b.xhr.status?(b.download_result=XF_DOWNLOADER.DOWNLOAD_RESULT_SUCCESS,b.download_message="",d=b.xhr.getResponseHeader("content-length"),null!=d&&d.length>0&&(b.file_size=a.originalEvent.total,b.file_brief_size=this._getfilebriefsize(b.file_size)),e=b.xhr.getResponseHeader("last-modified"),null!=e&&e.length>0&&(n=e.split(" "),f=n[3],g="Jan"==n[2]?"01":"Feb"==n[2]?"02":"Mar"==n[2]?"03":"Apr"==n[2]?"04":"May"==n[2]?"05":"Jun"==n[2]?"06":"Jul"==n[2]?"07":"Aug"==n[2]?"08":"Sep"==n[2]?"09":"Oct"==n[2]?"10":"Nov"==n[2]?"11":"Dec"==n[2]?"12":"00",h=n[1],i=n[4].substr(0,2),j=n[4].substr(3,2),k=n[4].substr(6,2),l=new Date(_xfu["int"](f),_xfu["int"](g)-1,_xfu["int"](h),_xfu["int"](i),_xfu["int"](j),_xfu["int"](k)),m=l.getTimezoneOffset(),l.setMinutes(_xfu["int"](j)+-1*m),b.file_modified_date=_xfp.date(l,"yyyymmdd"),b.file_modified_time=_xfp.time(l,"HHmmss")),this._saveaction(b,b.file_name,c)):this._setfilestatus(b,XF_DOWNLOADER.DOWNLOAD_STATUS_DONE,XF_DOWNLOADER.DOWNLOAD_RESULT_FAIL,b.xhr.status+":"+b.xhr.statusText,!1),this._on_file_complete(b)},XF_DOWNLOADER.prototype._saveaction=function(a,b,c){var d;window.navigator&&window.navigator.msSaveOrOpenBlob?(window.navigator.msSaveOrOpenBlob(c,b),c=null):(d=URL.createObjectURL(c),a.xf_anchor&&a.xf_anchor.remove(),a.xf_anchor=$('<a class = "_xf_text_anchor" target="_blank">'+b+"</a>"),a.xf_anchor.attr("download",b),a.xf_anchor.attr("href",d),a.xf_anchor.get(0).click(),URL.revokeObjectURL(d))},XF_DOWNLOADER.prototype.addfile=function(a,b){var c;return this.is_downloading?1:!this.xf_prop.allow_multifile&&this.getfilecount()>0?2:(c=[],c.push(this._createfileinfo(a,b)),this._mergefileinfoarr(c),0)},XF_DOWNLOADER.prototype.clearallfilestatus=function(){var a,b;if(this.is_downloading)return 1;for(a=this.file_info_arr.length,b=0;a>b;b++)this._clearfilestatus(this.file_info_arr[b]);return 0},XF_DOWNLOADER.prototype.clearfilestatusbyname=function(a){return this.clearfilestatus(this.getfileindex(a))},XF_DOWNLOADER.prototype.clearfilestatus=function(a){var b;return this.is_downloading?1:(a=_xfu["int"](a),b=this.file_info_arr[a],void 0===b?2:(this._clearfilestatus(b),0))},XF_DOWNLOADER.prototype._clearfilestatus=function(a){return a.download_result=XF_DOWNLOADER.DOWNLOAD_RESULT_FAIL,a.download_progress=0,a.download_message="",a.download_status=XF_DOWNLOADER.DOWNLOAD_STATUS_NONE,a.file_size=0,a.file_brief_size="0KB",a.file_modified_date="",a.file_modified_time="",a.xf_anchor&&(a.xf_anchor.remove(),a.xf_anchor=null),0},XF_DOWNLOADER.prototype.deleteallfile=function(){return this.is_downloading?!1:(this.file_info_arr=[],void _xfu.async({context:this,func:this._on_list_update}))},XF_DOWNLOADER.prototype.deletefilebyname=function(a){return this.deletefile(this.getfileindex(a))},XF_DOWNLOADER.prototype.deletefile=function(a){var b;return this.is_downloading?1:(a=_xfu["int"](a),b=this.file_info_arr[a],void 0===b?2:(this.file_info_arr.splice(a,1),this._resetfileindex(),factory._fireevent({xf_component:this,event_name:"on_filedelete",is_fire_async:!0},this,b.file_index,b.file_name),_xfu.async({context:this,func:this._on_list_update}),0))},XF_DOWNLOADER.prototype.getallowmultifile=function(){return this.xf_prop.allow_multifile},XF_DOWNLOADER.prototype.setallowmultifile=function(a){this.xf_prop.allow_multifile!=a&&(this.xf_prop.allow_multifile=a,this.xf_file.prop("multiple",a))},XF_DOWNLOADER.prototype.getfilecount=function(){return this.file_info_arr.length},XF_DOWNLOADER.prototype.getfileindex=function(a){var b,c;for(c=this.file_info_arr.length,b=0;c>b;b++)if(this.file_info_arr[b].file_name==a)return b;return-1},XF_DOWNLOADER.prototype.getaccept=function(){return this.xf_prop.accept},XF_DOWNLOADER.prototype.setaccept=function(a){return this.xf_prop.accept=a,this.xf_file.attr("accept",a),!0},XF_DOWNLOADER.prototype.getfilename=function(a){var b;return b=this._getfileinfo(a),b?b.file_name:""},XF_DOWNLOADER.prototype.getfiledatebyname=function(a){return this.getfiledate(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfiledate=function(a){var b;return b=this._getfileinfo(a),b?b.file_modified_date:""},XF_DOWNLOADER.prototype.getfiletimebyname=function(a){return this.getfiletime(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfiletime=function(a){var b;return b=this._getfileinfo(a),b?b.file_modified_time:""},XF_DOWNLOADER.prototype.getfiledatetimebyname=function(a,b){return this.getfiledatetime(this.getfileindex(a,b))},XF_DOWNLOADER.prototype.getfiledatetime=function(a,b){var c;return(c=this._getfileinfo(a))?(void 0===b&&(b=" "),c.file_modified_date+b+c.file_modified_time):""},XF_DOWNLOADER.prototype.getfilesizebyname=function(a){return this.getfilesize(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfilesize=function(a){var b;return b=this._getfileinfo(a),b?b.file_size:-1},XF_DOWNLOADER.prototype.getfilebriefsizebyname=function(a){return this.getfilebriefsize(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfilebriefsize=function(a){var b;return b=this._getfileinfo(a),b?b.file_brief_size:""},XF_DOWNLOADER.prototype.getfileprogressbyname=function(a){return this.getfileprogress(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfileprogress=function(a){var b;return b=this._getfileinfo(a),b?b.download_progress:-1},XF_DOWNLOADER.prototype.getfilestatusbyname=function(a){return this.getfilestatus(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfilestatus=function(a){var b;return b=this._getfileinfo(a),b?b.download_status:-1},XF_DOWNLOADER.prototype.getfileresultbyname=function(a){return this.getfileresult(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfileresult=function(a){var b;return b=this._getfileinfo(a),b?b.download_result:-1},XF_DOWNLOADER.prototype.getfileresultmsgbyname=function(a){return this.getfileresultmsg(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfileresultmsg=function(a){var b;return b=this._getfileinfo(a),b?b.download_message:""},XF_DOWNLOADER.prototype.getfileurlbyname=function(a){return this.getfileurl(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfileurl=function(a){var b;return b=this._getfileinfo(a),b?b.url:""},XF_DOWNLOADER.prototype.setfileurlbyname=function(a,b){return this.setfileurl(this.getfileindex(a),b)},XF_DOWNLOADER.prototype.setfileurl=function(a,b){var c;return(c=this._getfileinfo(a))?(c.url=b,!0):!1},XF_DOWNLOADER.prototype.setfilepostdataobjectbyname=function(a,b){return this.setfilepostdataobject(this.getfileindex(a),b)},XF_DOWNLOADER.prototype.setfilepostdataobject=function(a,b){var c;return(c=this._getfileinfo(a))?($.extend(c.post_data,b),!0):!1},XF_DOWNLOADER.prototype.setfilepostdatavaluebyname=function(a,b,c){return this.setfilepostdatavalue(this.getfileindex(a),b,c)},XF_DOWNLOADER.prototype.setfilepostdatavalue=function(a,b,c){var d;return(d=this._getfileinfo(a))?(d.post_data[b]=c,!0):!1},XF_DOWNLOADER.prototype.getfilepostdatavaluebyname=function(a,b){return this.getfilepostdatavalue(this.getfileindex(a),b)},XF_DOWNLOADER.prototype.getfilepostdatavalue=function(a,b){var c;return c=this._getfileinfo(a),c?c.post_data&&c.post_data[b]?c[b]:"":null},XF_DOWNLOADER.prototype.getfilepostdataobjectbyname=function(a){return this.getfilepostdataobject(this.getfileindex(a))},XF_DOWNLOADER.prototype.getfilepostdataobject=function(a){var b;return b=this._getfileinfo(a),b?b.post_data:null},XF_DOWNLOADER.prototype._getfileinfo=function(a){return a=_xfu["int"](a),this.file_info_arr[a]?this.file_info_arr[a]:null},XF_DOWNLOADER.prototype.getserialdownload=function(){return this.xf_prop.serial_download},XF_DOWNLOADER.prototype.setserialdownload=function(a){this.xf_prop.serial_download=a},XF_DOWNLOADER.prototype.getasyncdownload=function(){return this.xf_prop.async_download},XF_DOWNLOADER.prototype.setasyncdownload=function(a){this.xf_prop.async_download=a},XF_DOWNLOADER.prototype.getwithcredentials=function(){return this.xf_prop.with_credentials},XF_DOWNLOADER.prototype.setwithcredentials=function(a){this.xf_prop.with_credentials=a},XF_DOWNLOADER.prototype.geturl=function(){return this.xf_prop.url},XF_DOWNLOADER.prototype.seturl=function(a){this.xf_prop.url=a},XF_DOWNLOADER.prototype.startdownload=function(){var a,b;if(b=this.file_info_arr.length,0==b)return 1;if(0==this.xf_prop.allow_multifile&&this.getfilecount()>1)return 2;if(1==this.is_downloading)return 3;if(this.clearallfilestatus(),this.is_downloading=!0,this.is_stop_download=!1,this.file_info_index=0,1==this.xf_prop.serial_download)this._downloadonefile(this.file_info_arr[0]);else for(a=0;b>a;a++)this._downloadonefile(this.file_info_arr[a]);return 0},XF_DOWNLOADER.prototype.stopdownload=function(){var a,b,c;if(this.is_stop_download=!0,1==this.xf_prop.serial_download)c=this.file_info_arr[this.file_info_index],c.xhr.abort();else for(b=this.file_info_arr.length,a=0;b>a;a++)c=this.file_info_arr[a],c.xhr.abort()};